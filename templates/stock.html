{% extends 'base.html' %}

{% block scrips %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js"></script>

    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/ui-lightness/jquery-ui.css"
        rel="stylesheet" type="text/css" />
{% endblock %}

{% block content %}

<div class="row container-fluid">
    <div class="col-4 container">
        <h3 style="text-align: center">Додати новий продукт</h3>
        <form method="post">
            {{ form.csrf_token }}
            <div class="row">
                {{ form.name.label(class="form-label") }}
                {{ form.name(class="form-control") }}
            </div>
            <div class="row">
                <div class="col">
                    {{ form.quantity.label(class="form-label") }}
                    {{ form.quantity(class="form-control") }}
                </div>
                <div class="col">
                    {{ form.measure.label(class="form-label") }}
                    {{ form.measure(class="form-control") }}
                </div>
                <div class="col">
                    {{ form.price.label(class="form-label") }}
                    {{ form.price(class="form-control") }}
                </div>
            </div>
            <div class="row">
                <div class="col">
                    {{ form.produced_date.label(class="form-label") }}
                    {{ form.produced_date(class="form-control") }}
                </div>
                <div class="col">
                    {{ form.expired_date.label(class="form-label") }}
                    {{ form.expired_date(class="form-control") }}
                </div>
            </div>
            <br>
            <div class="row">
                {{ form.submit(class="btn btn-secondary") }}
            </div>
        </form>
    </div>
{#        <br>#}
{#        <h3 style="text-align: center">Використати продукт</h3>#}
{#        <form method="post">#}
{#            {{ useform.csrf_token }}#}
{#            <div class="row">#}
{#                {{ useform.name.label(class='form-label') }}#}
{#                {{ useform.name(class='form-control') }}#}
{#            </div>#}
{#            <div class="row form-check form-check-inline" id="full" >#}
{#                {{ useform.full.label(class='form-check-label', type='checkbox') }}#}
{#                {{ useform.full(class='form-check-input', type='checkbox', onclick='myFunction()') }}#}
{#            </div>#}
{#            <div class="row" id="quant">#}
{#                {{ useform.quant.label(class='form-label') }}#}
{#                {{ useform.quant(class='form-control') }}#}
{#            </div>#}
{#            <br>#}
{#            <div class="row">#}
{#                {{ useform.submit(class="btn btn-secondary") }}#}
{#            </div>#}
{#        </form>#}
{##}
{#    </div>#}

    <div class="col-8">
    <div class="row">
        {% for group, product in products %}
        {% for prod in product %}

            <div class="card col-4" >
                <div class="card-body">
                    <h5 class="card-title">{{ prod.product|capitalize() }} <span class="badge bg-primary">{{ prod.status }}</span></h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ prod.product.category }}</h6>
                    <p>До {{ prod.expired}}</p>
                    <a href="#" class="btn btn-sm btn-primary">Використати</a>
                    <a href="{{ url_for('throw_away', id=prod.id) }}" class="btn btn-sm btn-primary">Викинути</a>
                </div>
            </div>
        {% endfor %}
        {% endfor %}
</div>


    <div class="row">
    <h3 style="text-align: center">Мої продукти</h3>
    {% if products %}

        <table class="table table-striped">
            <tr>
                <th>Продукт</th>
                <th>К-сть</th>
                <th>Виготовлено</th>
                <th>Придатний до</th>
                <th>Вартість</th>
                <th>Статус</th>
                <th>Додано</th>
                <th></th>
            </tr>
            {% for group, product in products %}
            <tr>
                <td colspan="8"><h6>{{ group }}</h6></td>
                </tr>
                {% for prod in product %}
                <tr>
                    <td>{{ prod.product_name }}</td>
                    <td>{{ prod.quantity }} {{ prod.measure }}</td>
                    <td>{{ prod.produced }}</td>
                    <td>{{ prod.expired }}</td>
                    <td>{{ prod.price }} грн</td>
                    <td><span class="badge rounded-pill text-bg-primary">{{ prod.status }}</span></td>
                    <td>{{ prod.date_added }}</td>
                    <td>

                        <div class="btn-group-vertical btn-group-sm" role="group" aria-label="Button group with nested dropdown">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                part
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">Dropdown link</a></li>
                                    <li><a class="dropdown-item" href="#">Dropdown link</a></li>
                                </ul>
                            </div>
                            <button type="button" class="btn btn-primary">all</button>
                            <a href="{{ url_for('throw_away', id=prod.id) }}" class="btn btn-primary" >away</a>
                        </div>


                        <div class="dropdown">
                            <button class="btn rounded-pill btn-sm btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Дії
                            </button>
                            <ul class="dropdown-menu">
                                <li>
                                    <div class="dropdown">
                                        <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                                            Використати частину
                                        </button>
                                        <form class="dropdown-menu p-4">
                                            {{ useproduct_form.hidden_tag() }}
                                            <div class="mb-3">
                                                {{ useproduct_form.quantity }}
                                            </div>
                                                {{ useproduct_form.submit }}
                                        </form>
                                    </div>
                                </li>
                                <li><a class="dropdown-item" href="#">Використати частину</a></li>
                                <li><a class="dropdown-item" href="#">Використати все</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('throw_away', id=prod.id) }}">Викинути</a></li>
                            </ul>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            {% endfor %}
        </table>
    {% else %}
        <h3>У вас ще немає внесених продуктів</h3>
    {% endif %}
    </div>
<hr>
    <div class="row">
        <h3>Викинуто за весь час - {{ trash }} грн</h3>
    </div>
    </div>
</div>
    <script>
    function myFunc(){
        let checked = document.getElementById('full').checked
        if (checked){
             document.getElementById('quant').style.display = 'none';
        } else {
            document.getElementById('quant').style.display = 'block';

        }
    }
    myFunc()
    </script>
    <script>
    $( function() {
    var availableProds = [
        {% for product in all_products %}
            "{{product}}",
        {% endfor %}
    ];
    $( "#name" ).autocomplete({
      source: availableProds
    });
    } );
  </script>
{% endblock %}
